global
    daemon
    maxconn 4096
    log stdout local0 info

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option httplog
    log global
    
    # Health check options
    option httpchk GET /
    
    # Enable stats
    stats enable
    stats uri /haproxy-stats
    stats refresh 30s

# Frontend - receives requests from clients
frontend weather_frontend
    bind *:80
    
    # Add custom headers to identify load balancer
    http-request set-header X-Load-Balancer "HAProxy-Weather-LB"
    
    # Default backend for all requests
    default_backend weather_backend
    
    # Optional: Enable stats page
    acl is_stats path_beg /haproxy-stats
    use_backend stats if is_stats

# Backend - distributes requests to web servers
backend weather_backend
    balance roundrobin
    
    # Health check configuration
    option httpchk GET /
    http-check expect status 200
    
    # Add response header to identify which server handled the request
    http-response set-header X-Server-ID %s
    
    # Server definitions
    # Note: Replace IP addresses with actual server IPs in your environment
    server web01 172.20.0.11:8080 check inter 30s fall 3 rise 2
    server web02 172.20.0.12:8080 check inter 30s fall 3 rise 2

# Optional: Dedicated backend for stats
backend stats
    stats enable
    stats uri /haproxy-stats
    stats refresh 10s
    stats admin if TRUE